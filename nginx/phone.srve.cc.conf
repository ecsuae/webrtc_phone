location /ws {
  # Docker embedded DNS resolver (so nginx can re-resolve "kamailio")
  resolver 127.0.0.11 ipv6=off valid=10s;

  # Use variable so nginx resolves at runtime (not only at startup)
  set $kam_upstream http://kamailio:8443;

  proxy_pass $kam_upstream;

  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection "upgrade";

  proxy_set_header Host $host;
  proxy_set_header X-Forwarded-Proto https;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header Sec-WebSocket-Protocol $http_sec_websocket_protocol;

  proxy_read_timeout 3600;
  proxy_send_timeout 3600;
  proxy_connect_timeout 5s;
}
